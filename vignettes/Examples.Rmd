---
title: "Examples"
author: "Philip I. Pavlik Jr."
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Examples}
  %\VignetteEngine{knitr::rmarkdown}
  \usepackage[utf8]{inputenc}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```


# Load data
=========

Get the data free:

<a href="https://datashop.memphis.edu/DatasetInfo?datasetId=1465" class="uri">https://datashop.memphis.edu/DatasetInfo?datasetId=1465</a>

```{r, echo=TRUE}
    library(LKT)
library(ggplot2)

    # data.table is the base data type
    library(data.table)
    
    setwd("C:/Users/ppavl/OneDrive - The University of Memphis/IES Data")
    datafile<-"ds1465_tx_All_Data_64_2016_0720_222352.txt" 
    val<-read.table(colClasses = c("Anon.Student.Id"="character"),datafile,sep="\t", header=TRUE,quote="\"")
    val$KC..Default.<-val$Problem.Name
    # make it a datatable
    val= setDT(val)

    #make unstratified folds for crossvaldiations
    val$fold<-sample(1:5,length(val$Anon.Student.Id),replace=T)

    # get the times of each trial in seconds from 1970
    val$CF..Time.<-as.numeric(as.POSIXct(as.character(val$Time),format="%Y-%m-%d %H:%M:%S"))
    
    #make sure it is ordered in the way the code expects
    val<-val[order(val$Anon.Student.Id, val$CF..Time.),]

    #create a binary response column to predict and extract only data with a valid value
    val$CF..ansbin.<-ifelse(tolower(val$Outcome)=="correct",1,ifelse(tolower(val$Outcome)=="incorrect",0,-1))
    val<-val[val$CF..ansbin==0 | val$CF..ansbin.==1,]

   

    # create durations
    val$Duration..sec.<-(val$CF..End.Latency.+val$CF..Review.Latency.+500)/1000

    # this function needs times and durations but you don't need it if you don't want to model time effects
    val <- computeSpacingPredictors(val, "KC..Default.") #allows recency, spacing, forgetting features to run
```


```{r,echo=TRUE}
 library(LKT)
library(ggplot2)

    # data.table is the base data type
    library(data.table)
setwd("C:\\Users\\ppavl\\Dropbox\\Active Projects\\LDI-domain-modeling\\")

val<-setDT(read.table("ds4845_tx_All_Data_6977_2021_0723_141809.txt",sep="\t",
                      header=TRUE,na.strings="NA",quote="",comment.char = ""))
val$CF..ansbin.<-ifelse((val$Outcome)=="OK",1,0)
val$Outcome<-ifelse((val$Outcome)=="OK","CORRECT","INCORRECT")
val$CF..ansbin.<-as.numeric(val$CF..ansbin.)
val$KC..Default.<-val$KC..MATHia.
val<-val[val$KC..Default.!="",]
val<-val[val$Attempt.At.Step==1,]

    #make unstratified folds for crossvaldiations
    val$fold<-sample(1:5,length(val$Anon.Student.Id),replace=T)
    
    # get the times of each trial in seconds from 1970
    val$CF..Time.<-as.numeric(as.POSIXct(as.character(val$Time),format="%Y-%m-%d %H:%M:%S"))
    
    #make sure it is ordered in the way the code expects
    val<-val[order(val$Anon.Student.Id, val$CF..Time.),]

mnames<-c("SimplePFA",
          "Full PFA",
          "Full PFA full autoKC additive",
         # "Full PFA full autoKC interactive",
          "Simple PFA full autoKC interactive",
          "Full PFA simple autoKC interactive",
          "Simple PFA simple autoKC interactive",
         "Log SimplePFA",
          "Log Full PFA",
          "Log Full PFA full autoKC additive",
         # "Log Full PFA full autoKC interactive",
          "Log Simple PFA full autoKC interactive",
          "Log Full PFA simple autoKC interactive",
          "Log Simple PFA simple autoKC interactive")

cvr2s<-data.frame(name=mnames,cvr2s=NA)
  r2s<-data.frame(name=mnames,r2s=NA)
          
compl<-list(c("Anon.Student.Id","KC..Default.", "KC..Default.", "KC..Default."),
            c("Anon.Student.Id","KC..Default.", "KC..Default.", "KC..Default."),
            c("Anon.Student.Id","KC..Default.", "KC..Default.", "KC..Default." ,"KC..Default." ,"KC..Default."),
        #    c("Anon.Student.Id","KC..Default.", "KC..Default.", "KC..Default." ,"KC..Default." ,"KC..Default."),
            c("Anon.Student.Id","KC..Default.", "KC..Default.", "KC..Default." ,"KC..Default." ,"KC..Default."),
            c("Anon.Student.Id","KC..Default.", "KC..Default.", "KC..Default." ,"KC..Default." ,"KC..Default."),
            c("Anon.Student.Id","KC..Default.", "KC..Default.", "KC..Default." ,"KC..Default." ,"KC..Default."),c("Anon.Student.Id","KC..Default.", "KC..Default.", "KC..Default."),
            c("Anon.Student.Id","KC..Default.", "KC..Default.", "KC..Default."),
            c("Anon.Student.Id","KC..Default.", "KC..Default.", "KC..Default." ,"KC..Default." ,"KC..Default."),
        #    c("Anon.Student.Id","KC..Default.", "KC..Default.", "KC..Default." ,"KC..Default." ,"KC..Default."),
            c("Anon.Student.Id","KC..Default.", "KC..Default.", "KC..Default." ,"KC..Default." ,"KC..Default."),
            c("Anon.Student.Id","KC..Default.", "KC..Default.", "KC..Default." ,"KC..Default." ,"KC..Default."),
            c("Anon.Student.Id","KC..Default.", "KC..Default.", "KC..Default." ,"KC..Default." ,"KC..Default."))
featl<-list(c("intercept","intercept",  "linefail",  "linesuc"),
            c("intercept","intercept",  "linefail$", "linesuc$"),
            c("intercept","intercept",  "linefail$", "linefail$", "linesuc$", "linesuc$"),
        #    c("intercept","intercept",  "linefail$", "linefail$", "linesuc$", "linesuc$"),
            c("intercept","intercept",  "linefail", "linefail$", "linesuc", "linesuc$"),
            c("intercept","intercept",  "linefail$", "linefail", "linesuc$", "linesuc"),
            c("intercept","intercept",  "linefail", "linefail", "linesuc", "linesuc"),
        c("intercept","intercept",  "logfail",  "logsuc"),
            c("intercept","intercept",  "logfail$", "logsuc$"),
            c("intercept","intercept",  "logfail$", "logfail$", "logsuc$", "logsuc$"),
        #    c("intercept","intercept",  "logfail$", "logfail$", "logsuc$", "logsuc$"),
            c("intercept","intercept",  "logfail", "logfail$", "logsuc", "logsuc$"),
            c("intercept","intercept",  "logfail$", "logfail", "logsuc$", "logsuc"),
            c("intercept","intercept",  "logfail", "logfail", "logsuc", "logsuc"))
connl<-list(c("+","+","+","+"),
            c("+","+","+","+"),
            c("+","+","+","+","+","+"),
        #    c("+","+","+","*","+","*"),
            c("+","+","+","*","+","*"),
            c("+","+","+","*","+","*"),
            c("+","+","+","*","+","*"),
        c("+","+","+","+"),
            c("+","+","+","+"),
            c("+","+","+","+","+","+"),
        #    c("+","+","+","*","+","*"),
            c("+","+","+","*","+","*"),
            c("+","+","+","*","+","*"),
            c("+","+","+","*","+","*"))
autol <- list(c(F,F,F,F),
              c(F,F,F,F),
              c(F,F,F,T,F,T),
          #    c(F,F,F,T,F,T),
              c(F,F,F,T,F,T),
              c(F,F,F,T,F,T),
              c(F,F,F,T,F,T),
          c(F,F,F,F),
              c(F,F,F,F),
              c(F,F,F,T,F,T),
          #    c(F,F,F,T,F,T),
              c(F,F,F,T,F,T),
              c(F,F,F,T,F,T),
              c(F,F,F,T,F,T))

for(i in 1:length(compl)){
  modelob <<- LKT(data = val,components = compl[[i]],features = featl[[i]],connectors = connl[[i]],autoKC = autol[[i]],
                 cv=TRUE,verbose = FALSE,
                 autocent=4)
    cat(mnames[i]," R2cv =  ",mean(modelob$cv_res$mcfad))
    cat(" R2 =  ",modelob$r2,"\n")
    
    r2s$r2s[i]<-modelob$r2
    r2s$cvr2s[i]<-mean(modelob$cv_res$mcfad)
    }

r2s$r2s<-r2s$r2s-min(r2s$r2s)
r2s$name <- factor(r2s$name,levels = rev(mnames))
plot<-ggplot(r2s,
             aes(name,r2s)) +
geom_bar(stat = "identity") + 
coord_flip()
plot


r2s$cvr2s<-r2s$cvr2s-min(r2s$cvr2s)
r2s$name <- factor(r2s$name,levels = rev(mnames))
plot<-ggplot(r2s,
             aes(name,cvr2s)) +
geom_bar(stat = "identity") + 
coord_flip()
plot
```

# Additive Factors Model (AFM) fixed effect version

```{r, echo=TRUE}
    modelob <- LKT(
      data = val, interc=TRUE,
      components = c("Anon.Student.Id","KC..Default.","KC..Default."),
      features = c("intercept", "intercept", "lineafm$"))
```

# Performance Factors Analysis (PFA) fixed effect version

```{r, echo=TRUE}
    modelob <- LKT(
      data = val, interc=TRUE,
      components = c("Anon.Student.Id", "KC..Default.", "KC..Default.", "KC..Default."),
      features = c("intercept", "intercept", "linesuc$","linefail$"))
    # have to have prior predictions in data to do the next model in and adaptive system
    #   this needs to be added to the data wth a first moodel like this
    val$pred<-modelob$prediction
```

PFA random effect version too slow for seminar and mostly just to allow
comparison models (impractical) modelob &lt;- LKT( data = val,
interc=TRUE, components = c(“Anon.Student.Id”, “KC..Default.”,
“KC..Default.”, “KC..Default.”), features = c(“intercept@”, “intercept”,
“linesuc”,“linefail”))

# PFA using difficulty sensitive predictors (composite model requiring pred from prior model)

```{r, echo=TRUE}
    modelob <- LKT(
      data = val, interc=TRUE,
      components = c("Anon.Student.Id", "KC..Default.", "KC..Default.", "KC..Default."),
      features = c("intercept", "intercept", "linesuc$","linefail$"))
    # have to have prior predictions in data to do the next model in and adaptive system
    #   this needs to be added to the data wth a first moodel like this
    val$pred<-modelob$prediction
    
    modelob <- LKT(
      data = val, interc=TRUE,
      components = c("Anon.Student.Id", "KC..Default.", "KC..Default.", "KC..Default."),
      features = c("intercept", "intercept", "diffcorComp","linefail"))
```

# Recent Performance Factors Analysis (RPFA)

```{r, echo=TRUE}
    modelob <- LKT(
      data = val, interc=TRUE,
      components = c("Anon.Student.Id", "KC..Default.", "KC..Default.", "KC..Default."),
      features = c("intercept", "intercept", "propdec2","linefail"),
      fixedpars=c(.9))
```

# Recency tracing with logitdec

```{r, echo=TRUE}
    modelob <- LKT(
      data = val, interc=TRUE,
      components = c("Anon.Student.Id", "KC..Default.", "KC..Default.", "KC..Default."),
      features = c("intercept", "intercept", "logitdec","recency"),
      fixedpars=c(.9,.5))
```

# Recency tracing with logitdec and transfer from cluster

```{r, echo=TRUE}

modelob <- LKT(
      data = val, interc=TRUE,
      components = c("Anon.Student.Id", "KC..Default.", "KC..Default.", "KC..Default.","KC..Cluster."),
      features = c("intercept", "intercept", "logitdec","recency","logitdec"),
      fixedpars=c(.9,.5,.5))
```

# Recency tracing with RPFA propdec2 feature

```{r, echo=TRUE}
    modelob <- LKT(
      data = val, interc=TRUE,
      components = c("Anon.Student.Id", "KC..Default.", "KC..Default.", "KC..Default."),
      features = c("intercept", "intercept", "propdec2","recency"),
      fixedpars=c(NA,NA))
```

# Performance Prediction Equation (PPE)

```{r, echo=TRUE}
    modelob <- LKT(
      data = val, interc=TRUE,
      components = c("Anon.Student.Id", "KC..Default.", "KC..Default.", "KC..Default."),
      features = c("intercept", "intercept", "ppe","logitdec"),
      fixedpars=c(0.3491901,0.2045801,1e-05,0.9734477,0.4443027))
```

# base4

```{r, echo=TRUE}
    modelob <- LKT(
      data = val, interc=TRUE,
      components = c("Anon.Student.Id", "KC..Default.", "KC..Default.", "KC..Default."),
      features = c("intercept", "intercept", "base4","logitdec"),
      fixedpars=c(0.1890747,0.6309054,0.05471752,.5,0.2160748))
```

Using other features #See LKT paper #See computefeatures function in
the main R code for package
<a href="https://github.com/Optimal-Learning-Lab/LKT/blob/master/R/LKTfunctions.R" class="uri">https://github.com/Optimal-Learning-Lab/LKT/blob/master/R/LKTfunctions.R</a>


# Covariates

```{r, echo=TRUE}
    modelob <- LKT(
      data = val, interc=TRUE,
      components = c("Anon.Student.Id","KC..Default.","KC..Default."),
      features = c("logitdec", "logitdec", "lineafm"),fixedpars=c(.9,.8),
      covariates = c(NA,NA,"Level..Unitname."))
```

# Individualized Additive Factors Model (iAFM) fixed effect version

```{r, echo=TRUE}
    modelob <- LKT(
      data = val, interc=TRUE,
      components = c("Anon.Student.Id","KC..Default.","KC..Default.","KC..Default."),
      features = c("intercept", "intercept", "lineafm$","lineafm"),
      covariates = c(NA,NA,NA,"Anon.Student.Id"))
```

# Crossvalidation

```{r, echo=TRUE}
# make student stratified folds (for crossvalidation for unseen population)
    unq = sample(unique(val$Anon.Student.Id))
    sfold = rep(1:5,length.out=length(unq))
    val$fold = rep(0,length(val[,1]))
    for(i in 1:5){val$fold[which(val$Anon.Student.Id %in% unq[which(sfold==i)])]=i}

    #simple AFM minus student intercept
    modelob <- LKT(
      data = val, interc=TRUE,
      components = c("KC..Default.","KC..Default."),
      features = c("intercept", "lineafm"),
      cv = TRUE)
    mean(modelob$cv_res$mcfad)

    #complex AFM minus student intercept
    modelob <- LKT(
      data = val, interc=TRUE,
      components = c("KC..Default.","KC..Default."),
      features = c("intercept$", "lineafm$"),
      cv = TRUE)
    mean(modelob$cv_res$mcfad)
```

# Connectors

```{r, echo=TRUE}
    modelob <- LKT(
      data = val, interc=TRUE,
      connectors = c("+","+","*"),
      components = c("Anon.Student.Id", "KC..Default.", "KC..Default."),
      features = c("logitdec", "logitdec$", "lineafm$"),
      fixedpars = c(.9, .85) )
```

# AutoKC

```{r, echo=TRUE, warning=TRUE, message=TRUE, include=TRUE}



```


```{r}
library(LKT)
library(ggplot2)

    # data.table is the base data type
    library(data.table)
    
    setwd("C:/Users/ppavl/OneDrive - The University of Memphis/IES Data")
    datafile<-"ds1465_tx_All_Data_64_2016_0720_222352.txt" 
    val<-read.table(colClasses = c("Anon.Student.Id"="character"),datafile,sep="\t", header=TRUE,quote="\"")
    val$KC..Default.<-val$Problem.Name
    # make it a datatable
    val= setDT(val)

    #make unstratified folds for crossvaldiations
    val$fold<-sample(1:5,length(val$Anon.Student.Id),replace=T)

    # get the times of each trial in seconds from 1970
    val$CF..Time.<-as.numeric(as.POSIXct(as.character(val$Time),format="%Y-%m-%d %H:%M:%S"))
    
    #make sure it is ordered in the way the code expects
    val<-val[order(val$Anon.Student.Id, val$CF..Time.),]

    #create a binary response column to predict and extract only data with a valid value
    val$CF..ansbin.<-ifelse(tolower(val$Outcome)=="correct",1,ifelse(tolower(val$Outcome)=="incorrect",0,-1))
    val<-val[val$CF..ansbin==0 | val$CF..ansbin.==1,]

   

    # create durations
    val$Duration..sec.<-(val$CF..End.Latency.+val$CF..Review.Latency.+500)/1000

    # this function needs times and durations but you don't need it if you don't want to model time effects
    val <- computeSpacingPredictors(val, "KC..Default.") #allows recency, spacing, forgetting features to run
    
    
    mnames<-c("IRT",
"Faculty",
"Log Full autoKC",
"Log Simple PFA",
"Log Full PFA",
"Log Full PFA full autoKC additive",
"Log Simple PFA Simple Faculty interactive ",
# "Log Full PFA full autoKC interactive",
"Log Simple PFA full autoKC interactive",
"Log Full PFA simple autoKC interactive",
"Log Simple PFA simple autoKC interactive")
r2s<-data.frame(name=mnames,r2s=NA,cvr2s=NA)
compl<-list(c("Anon.Student.Id","KC..Default."),
c("Anon.Student.Id","KC..Default.", "Anon.Student.Id", "Anon.Student.Id"),
c("Anon.Student.Id","KC..Default.", "KC..Default.", "KC..Default."),
c("Anon.Student.Id","KC..Default.", "KC..Default.", "KC..Default."),
c("Anon.Student.Id","KC..Default.", "KC..Default.", "KC..Default."),
c("Anon.Student.Id","KC..Default.", "KC..Default.", "KC..Default." ,"KC..Default." ,"KC..Default."),

c("Anon.Student.Id","KC..Default.", "KC..Default.","Anon.Student.Id", "KC..Default."  ,"Anon.Student.Id"),
#    c("Anon.Student.Id","KC..Default.", "KC..Default.", "KC..Default." ,"KC..Default." ,"KC..Default."),
c("Anon.Student.Id","KC..Default.", "KC..Default.", "KC..Default." ,"KC..Default." ,"KC..Default."),
c("Anon.Student.Id","KC..Default.", "KC..Default.", "KC..Default." ,"KC..Default." ,"KC..Default."),
c("Anon.Student.Id","KC..Default.", "KC..Default.", "KC..Default." ,"KC..Default." ,"KC..Default."))
featl<-list(c("intercept","intercept"),
c("intercept","intercept",  "logfail",  "logsuc"),
c("intercept","intercept",  "logfail$",  "logsuc$"),
c("intercept","intercept",  "logfail", "logsuc"),
c("intercept","intercept",  "logfail$", "logsuc$"),
c("intercept","intercept",  "logfail$", "logfail$", "logsuc$", "logsuc$"),
c("intercept","intercept",  "logfail", "logfail", "logsuc", "logsuc"),
#    c("intercept","intercept",  "logfail$", "logfail$", "logsuc$", "logsuc$"),
c("intercept","intercept",  "logfail", "logfail$", "logsuc", "logsuc$"),
c("intercept","intercept",  "logfail$", "logfail", "logsuc$", "logsuc"),
c("intercept","intercept",  "logfail", "logfail", "logsuc", "logsuc"))
connl<-list(c("+","+"),
c("+","+","+","+"),
c("+","+","+","+"),
c("+","+","+","+"),
c("+","+","+","+"),
c("+","+","+","+","+","+"),
c("+","+","+","*","+","*"),
#    c("+","+","+","*","+","*"),
c("+","+","+","*","+","*"),
c("+","+","+","*","+","*"),
c("+","+","+","*","+","*"))
autol <- list(c(F,F),
c(F,F,F,F),
c(F,F,T,T),
c(F,F,F,F),
c(F,F,F,F),
c(F,F,F,T,F,T),
c(F,F,F,F,F,F),
#    c(F,F,F,T,F,T),
c(F,F,F,T,F,T),
c(F,F,F,T,F,T),
c(F,F,F,T,F,T))
for(i in 1:length(compl)){
modelob <<- LKT(data = val,components = compl[[i]],features = featl[[i]],connectors = connl[[i]],autoKC = autol[[i]],
cv=TRUE,verbose = FALSE,
autocent=4)
cat(mnames[i]," R2cv =  ",mean(modelob$cv_res$mcfad))
cat(" R2 =  ",modelob$r2,"\n")
r2s$r2s[i]<-modelob$r2
r2s$cvr2s[i]<-mean(modelob$cv_res$mcfad)
}
r2s$r2s<-r2s$r2s-min(r2s$r2s)
r2s$name <- factor(r2s$name,levels = rev(mnames))
plot<-ggplot(r2s,
aes(name,r2s)) +
geom_bar(stat = "identity") +xlab("Model Version") + ylab("McFadden's R-squared")+
coord_flip()
plot
r2s$cvr2s<-r2s$cvr2s-min(r2s$cvr2s)
r2s$name <- factor(r2s$name,levels = rev(mnames))
plot<-ggplot(r2s,
aes(name,cvr2s)) +
geom_bar(stat = "identity") +xlab("Model Version") + ylab("McFadden's R-squared")+
coord_flip()
plot


mnames<-2:71
  r2s<-data.frame(name=mnames,r2s=NA,cvr2s=NA)
  
  for(k in mnames){
i<-6
 modelob <- LKT(data = val,components = compl[[i]],features = featl[[i]],connectors = connl[[i]],autoKC = autol[[i]],
                 cv=TRUE,verbose = FALSE,
                 autocent=k)
    cat(k," R2cv =  ",mean(modelob$cv_res$mcfad))
    cat(" R2 =  ",modelob$r2,"\n")
    
    r2s$r2s[k-1]<-modelob$r2
    r2s$cvr2s[k-1]<-mean(modelob$cv_res$mcfad)
}

r2s$r2s<-r2s$r2s-min(r2s$r2s)
r2s$name <- factor(r2s$name,levels = (mnames))
plot<-ggplot(r2s,
             aes(name,r2s,group=1)) +
  geom_line()+
  geom_point()
plot


r2s$cvr2s<-r2s$cvr2s-min(r2s$cvr2s)
r2s$name <- factor(r2s$name,levels = (mnames))
plot<-ggplot(r2s,
             aes(name,cvr2s,group=1)) +
  geom_line()+
  geom_point()
plot

```

```{r}
library(LKT)
library(ggplot2)

    # data.table is the base data type
    library(data.table)
setwd("C:\\Users\\ppavl\\Dropbox\\Active Projects\\LDI-domain-modeling\\")

val<-setDT(read.table("ds4845_tx_All_Data_6977_2021_0723_141809.txt",sep="\t",
                      header=TRUE,na.strings="NA",quote="",comment.char = ""))
val$CF..ansbin.<-ifelse((val$Outcome)=="OK",1,0)
val$Outcome<-ifelse((val$Outcome)=="OK","CORRECT","INCORRECT")
val$CF..ansbin.<-as.numeric(val$CF..ansbin.)
val$KC..Default.<-val$KC..MATHia.
val<-val[val$KC..Default.!="",]
val<-val[val$Attempt.At.Step==1,]

    #make unstratified folds for crossvaldiations
    val$fold<-sample(1:5,length(val$Anon.Student.Id),replace=T)
    
    # get the times of each trial in seconds from 1970
    val$CF..Time.<-as.numeric(as.POSIXct(as.character(val$Time),format="%Y-%m-%d %H:%M:%S"))
    
    #make sure it is ordered in the way the code expects
    val<-val[order(val$Anon.Student.Id, val$CF..Time.),]

    
    
    mnames<-c("IRT",
"Faculty",
"Log Full autoKC",
"Log Simple PFA",
"Log Full PFA",
"Log Full PFA full autoKC additive",
"Log Simple PFA Simple Faculty interactive ",
# "Log Full PFA full autoKC interactive",
"Log Simple PFA full autoKC interactive",
"Log Full PFA simple autoKC interactive",
"Log Simple PFA simple autoKC interactive")
r2s<-data.frame(name=mnames,r2s=NA,cvr2s=NA)
compl<-list(c("Anon.Student.Id","KC..Default."),
c("Anon.Student.Id","KC..Default.", "Anon.Student.Id", "Anon.Student.Id"),
c("Anon.Student.Id","KC..Default.", "KC..Default.", "KC..Default."),
c("Anon.Student.Id","KC..Default.", "KC..Default.", "KC..Default."),
c("Anon.Student.Id","KC..Default.", "KC..Default.", "KC..Default."),
c("Anon.Student.Id","KC..Default.", "KC..Default.", "KC..Default." ,"KC..Default." ,"KC..Default."),

c("Anon.Student.Id","KC..Default.", "KC..Default.","Anon.Student.Id", "KC..Default."  ,"Anon.Student.Id"),
#    c("Anon.Student.Id","KC..Default.", "KC..Default.", "KC..Default." ,"KC..Default." ,"KC..Default."),
c("Anon.Student.Id","KC..Default.", "KC..Default.", "KC..Default." ,"KC..Default." ,"KC..Default."),
c("Anon.Student.Id","KC..Default.", "KC..Default.", "KC..Default." ,"KC..Default." ,"KC..Default."),
c("Anon.Student.Id","KC..Default.", "KC..Default.", "KC..Default." ,"KC..Default." ,"KC..Default."))
featl<-list(c("intercept","intercept"),
c("intercept","intercept",  "logfail",  "logsuc"),
c("intercept","intercept",  "logfail$",  "logsuc$"),
c("intercept","intercept",  "logfail", "logsuc"),
c("intercept","intercept",  "logfail$", "logsuc$"),
c("intercept","intercept",  "logfail$", "logfail$", "logsuc$", "logsuc$"),
c("intercept","intercept",  "logfail", "logfail", "logsuc", "logsuc"),
#    c("intercept","intercept",  "logfail$", "logfail$", "logsuc$", "logsuc$"),
c("intercept","intercept",  "logfail", "logfail$", "logsuc", "logsuc$"),
c("intercept","intercept",  "logfail$", "logfail", "logsuc$", "logsuc"),
c("intercept","intercept",  "logfail", "logfail", "logsuc", "logsuc"))
connl<-list(c("+","+"),
c("+","+","+","+"),
c("+","+","+","+"),
c("+","+","+","+"),
c("+","+","+","+"),
c("+","+","+","+","+","+"),
c("+","+","+","*","+","*"),
#    c("+","+","+","*","+","*"),
c("+","+","+","*","+","*"),
c("+","+","+","*","+","*"),
c("+","+","+","*","+","*"))
autol <- list(c(F,F),
c(F,F,F,F),
c(F,F,T,T),
c(F,F,F,F),
c(F,F,F,F),
c(F,F,F,T,F,T),
c(F,F,F,F,F,F),
#    c(F,F,F,T,F,T),
c(F,F,F,T,F,T),
c(F,F,F,T,F,T),
c(F,F,F,T,F,T))
for(i in 1:length(compl)){
modelob <<- LKT(data = val,components = compl[[i]],features = featl[[i]],connectors = connl[[i]],autoKC = autol[[i]],
cv=TRUE,verbose = FALSE,
autocent=4)
cat(mnames[i]," R2cv =  ",mean(modelob$cv_res$mcfad))
cat(" R2 =  ",modelob$r2,"\n")
r2s$r2s[i]<-modelob$r2
r2s$cvr2s[i]<-mean(modelob$cv_res$mcfad)
}
r2s$r2s<-r2s$r2s-min(r2s$r2s)
r2s$name <- factor(r2s$name,levels = rev(mnames))
plot<-ggplot(r2s,
aes(name,r2s)) +
geom_bar(stat = "identity") +xlab("Model Version") + ylab("McFadden's R-squared")+
coord_flip()
plot
r2s$cvr2s<-r2s$cvr2s-min(r2s$cvr2s)
r2s$name <- factor(r2s$name,levels = rev(mnames))
plot<-ggplot(r2s,
aes(name,cvr2s)) +
geom_bar(stat = "identity") +xlab("Model Version") + ylab("McFadden's R-squared")+
coord_flip()
plot


mnames<-2:8
  r2s<-data.frame(name=mnames,r2s=NA,cvr2s=NA)
  
  for(k in mnames){
i<-6
 modelob <- LKT(data = val,components = compl[[i]],features = featl[[i]],connectors = connl[[i]],autoKC = autol[[i]],
                 cv=TRUE,verbose = FALSE,
                 autocent=k)
    cat(k," R2cv =  ",mean(modelob$cv_res$mcfad))
    cat(" R2 =  ",modelob$r2,"\n")
    
    r2s$r2s[k-1]<-modelob$r2
    r2s$cvr2s[k-1]<-mean(modelob$cv_res$mcfad)
}

r2s$r2s<-r2s$r2s-min(r2s$r2s)
r2s$name <- factor(r2s$name,levels = (mnames))
plot<-ggplot(r2s,
             aes(name,r2s,group=1)) +
  geom_line()+
  geom_point()
plot


r2s$cvr2s<-r2s$cvr2s-min(r2s$cvr2s)
r2s$name <- factor(r2s$name,levels = (mnames))
plot<-ggplot(r2s,
             aes(name,cvr2s,group=1)) +
  geom_line()+
  geom_point()
plot

```
```{r}
library(LKT)
library(ggplot2)

    # data.table is the base data type
    library(data.table)
    
    setwd("C:/Users/ppavl/OneDrive - The University of Memphis/IES Data")
    datafile<-"ds1465_tx_All_Data_64_2016_0720_222352.txt" 
    val<-read.table(colClasses = c("Anon.Student.Id"="character"),datafile,sep="\t", header=TRUE,quote="\"")
    val$KC..Default.<-val$Problem.Name
    # make it a datatable
    val= setDT(val)

    #make unstratified folds for crossvaldiations
    val$fold<-sample(1:5,length(val$Anon.Student.Id),replace=T)

    # get the times of each trial in seconds from 1970
    val$CF..Time.<-as.numeric(as.POSIXct(as.character(val$Time),format="%Y-%m-%d %H:%M:%S"))
    
    #make sure it is ordered in the way the code expects
    val<-val[order(val$Anon.Student.Id, val$CF..Time.),]

    #create a binary response column to predict and extract only data with a valid value
    val$CF..ansbin.<-ifelse(tolower(val$Outcome)=="correct",1,ifelse(tolower(val$Outcome)=="incorrect",0,-1))
    val<-val[val$CF..ansbin==0 | val$CF..ansbin.==1,]

   

    # create durations
    val$Duration..sec.<-(val$CF..End.Latency.+val$CF..Review.Latency.+500)/1000

    # this function needs times and durations but you don't need it if you don't want to model time effects
    val <- computeSpacingPredictors(val, "KC..Default.") #allows recency, spacing, forgetting features to run
    
    
    mnames<-c("IRT",
"Faculty",
"Log Full autoKC",
"Log Simple PFA",
"Log Full PFA",
"Log Full PFA full autoKC additive",
# "Log Full PFA full autoKC interactive",
"Log Simple PFA full autoKC interactive",
"Log Full PFA simple autoKC interactive",
"Log Simple PFA simple autoKC interactive")
r2s<-data.frame(name=mnames,r2s=NA,cvr2s=NA)
compl<-list(c("Anon.Student.Id","KC..Default."),
c("Anon.Student.Id","KC..Default.", "Anon.Student.Id", "Anon.Student.Id"),
c("Anon.Student.Id","KC..Default.", "KC..Default.", "KC..Default."),
c("Anon.Student.Id","KC..Default.", "KC..Default.", "KC..Default."),
c("Anon.Student.Id","KC..Default.", "KC..Default.", "KC..Default."),
c("Anon.Student.Id","KC..Default.", "KC..Default.", "KC..Default." ,"KC..Default." ,"KC..Default."),
#    c("Anon.Student.Id","KC..Default.", "KC..Default.", "KC..Default." ,"KC..Default." ,"KC..Default."),
c("Anon.Student.Id","KC..Default.", "KC..Default.", "KC..Default." ,"KC..Default." ,"KC..Default."),
c("Anon.Student.Id","KC..Default.", "KC..Default.", "KC..Default." ,"KC..Default." ,"KC..Default."),
c("Anon.Student.Id","KC..Default.", "KC..Default.", "KC..Default." ,"KC..Default." ,"KC..Default."))
featl<-list(c("intercept","intercept"),
c("intercept","intercept",  "logfail",  "logsuc"),
c("intercept","intercept",  "logfail$",  "logsuc$"),
c("intercept","intercept",  "logfail", "logsuc"),
c("intercept","intercept",  "logfail$", "logsuc$"),
c("intercept","intercept",  "logfail$", "logfail$", "logsuc$", "logsuc$"),
#    c("intercept","intercept",  "logfail$", "logfail$", "logsuc$", "logsuc$"),
c("intercept","intercept",  "logfail", "logfail$", "logsuc", "logsuc$"),
c("intercept","intercept",  "logfail$", "logfail", "logsuc$", "logsuc"),
c("intercept","intercept",  "logfail", "logfail", "logsuc", "logsuc"))
connl<-list(c("+","+"),
c("+","+","+","+"),
c("+","+","+","+"),
c("+","+","+","+"),
c("+","+","+","+"),
c("+","+","+","+","+","+"),
#    c("+","+","+","*","+","*"),
c("+","+","+","*","+","*"),
c("+","+","+","*","+","*"),
c("+","+","+","*","+","*"))
autol <- list(c(F,F),
c(F,F,F,F),
c(F,F,T,T),
c(F,F,F,F),
c(F,F,F,F),
c(F,F,F,T,F,T),
#    c(F,F,F,T,F,T),
c(F,F,F,T,F,T),
c(F,F,F,T,F,T),
c(F,F,F,T,F,T))
for(i in 1:length(compl)){
modelob <<- LKT(data = val,components = compl[[i]],features = featl[[i]],connectors = connl[[i]],autoKC = autol[[i]],autoKCcont = "rand",
cv=TRUE,verbose = FALSE,
autocent=4)
cat(mnames[i]," R2cv =  ",mean(modelob$cv_res$mcfad))
cat(" R2 =  ",modelob$r2,"\n")
r2s$r2s[i]<-modelob$r2
r2s$cvr2s[i]<-mean(modelob$cv_res$mcfad)
}
r2s$r2s<-r2s$r2s-min(r2s$r2s)
r2s$name <- factor(r2s$name,levels = rev(mnames))
plot<-ggplot(r2s,
aes(name,r2s)) +
geom_bar(stat = "identity") +
coord_flip()
plot
r2s$cvr2s<-r2s$cvr2s-min(r2s$cvr2s)
r2s$name <- factor(r2s$name,levels = rev(mnames))
plot<-ggplot(r2s,
aes(name,cvr2s)) +
geom_bar(stat = "identity") +
coord_flip()
plot

```

```{r}
library(LKT)
library(ggplot2)

    # data.table is the base data type
    library(data.table)
setwd("C:\\Users\\ppavl\\Dropbox\\Active Projects\\LDI-domain-modeling\\")

val<-setDT(read.table("ds4845_tx_All_Data_6977_2021_0723_141809.txt",sep="\t",
                      header=TRUE,na.strings="NA",quote="",comment.char = ""))
val$CF..ansbin.<-ifelse((val$Outcome)=="OK",1,0)
val$Outcome<-ifelse((val$Outcome)=="OK","CORRECT","INCORRECT")
val$CF..ansbin.<-as.numeric(val$CF..ansbin.)
val$KC..Default.<-val$KC..MATHia.
val<-val[val$KC..Default.!="",]
val<-val[val$Attempt.At.Step==1,]

    #make unstratified folds for crossvaldiations
    val$fold<-sample(1:5,length(val$Anon.Student.Id),replace=T)
    
    # get the times of each trial in seconds from 1970
    val$CF..Time.<-as.numeric(as.POSIXct(as.character(val$Time),format="%Y-%m-%d %H:%M:%S"))
    
    #make sure it is ordered in the way the code expects
    val<-val[order(val$Anon.Student.Id, val$CF..Time.),]

    
    
    mnames<-c("IRT",
"Faculty",
"Log Full autoKC",
"Log Simple PFA",
"Log Full PFA",
"Log Full PFA full autoKC additive",
# "Log Full PFA full autoKC interactive",
"Log Simple PFA full autoKC interactive",
"Log Full PFA simple autoKC interactive",
"Log Simple PFA simple autoKC interactive")
r2s<-data.frame(name=mnames,r2s=NA,cvr2s=NA)
compl<-list(c("Anon.Student.Id","KC..Default."),
c("Anon.Student.Id","KC..Default.", "Anon.Student.Id", "Anon.Student.Id"),
c("Anon.Student.Id","KC..Default.", "KC..Default.", "KC..Default."),
c("Anon.Student.Id","KC..Default.", "KC..Default.", "KC..Default."),
c("Anon.Student.Id","KC..Default.", "KC..Default.", "KC..Default."),
c("Anon.Student.Id","KC..Default.", "KC..Default.", "KC..Default." ,"KC..Default." ,"KC..Default."),
#    c("Anon.Student.Id","KC..Default.", "KC..Default.", "KC..Default." ,"KC..Default." ,"KC..Default."),
c("Anon.Student.Id","KC..Default.", "KC..Default.", "KC..Default." ,"KC..Default." ,"KC..Default."),
c("Anon.Student.Id","KC..Default.", "KC..Default.", "KC..Default." ,"KC..Default." ,"KC..Default."),
c("Anon.Student.Id","KC..Default.", "KC..Default.", "KC..Default." ,"KC..Default." ,"KC..Default."))
featl<-list(c("intercept","intercept"),
c("intercept","intercept",  "logfail",  "logsuc"),
c("intercept","intercept",  "logfail$",  "logsuc$"),
c("intercept","intercept",  "logfail", "logsuc"),
c("intercept","intercept",  "logfail$", "logsuc$"),
c("intercept","intercept",  "logfail$", "logfail$", "logsuc$", "logsuc$"),
#    c("intercept","intercept",  "logfail$", "logfail$", "logsuc$", "logsuc$"),
c("intercept","intercept",  "logfail", "logfail$", "logsuc", "logsuc$"),
c("intercept","intercept",  "logfail$", "logfail", "logsuc$", "logsuc"),
c("intercept","intercept",  "logfail", "logfail", "logsuc", "logsuc"))
connl<-list(c("+","+"),
c("+","+","+","+"),
c("+","+","+","+"),
c("+","+","+","+"),
c("+","+","+","+"),
c("+","+","+","+","+","+"),
#    c("+","+","+","*","+","*"),
c("+","+","+","*","+","*"),
c("+","+","+","*","+","*"),
c("+","+","+","*","+","*"))
autol <- list(c(F,F),
c(F,F,F,F),
c(F,F,T,T),
c(F,F,F,F),
c(F,F,F,F),
c(F,F,F,T,F,T),
#    c(F,F,F,T,F,T),
c(F,F,F,T,F,T),
c(F,F,F,T,F,T),
c(F,F,F,T,F,T))
for(i in 1:length(compl)){
modelob <<- LKT(data = val,components = compl[[i]],features = featl[[i]],connectors = connl[[i]],autoKC = autol[[i]],
cv=TRUE,verbose = FALSE,
autocent=4)
cat(mnames[i]," R2cv =  ",mean(modelob$cv_res$mcfad))
cat(" R2 =  ",modelob$r2,"\n")
r2s$r2s[i]<-modelob$r2
r2s$cvr2s[i]<-mean(modelob$cv_res$mcfad)
}
r2s$r2s<-r2s$r2s-min(r2s$r2s)
r2s$name <- factor(r2s$name,levels = rev(mnames))
plot<-ggplot(r2s,
aes(name,r2s)) +
geom_bar(stat = "identity") +
coord_flip()
plot
r2s$cvr2s<-r2s$cvr2s-min(r2s$cvr2s)
r2s$name <- factor(r2s$name,levels = rev(mnames))
plot<-ggplot(r2s,
aes(name,cvr2s)) +
geom_bar(stat = "identity") +
coord_flip()
plot

```

